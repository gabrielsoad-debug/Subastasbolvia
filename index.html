<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subastas Bolivia - Sistema VIP</title>
    
    <!-- SOLUCIÓN CSP PARA GITHUB PAGES -->
    <meta http-equiv="Content-Security-Policy" 
          content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;
                   script-src * 'unsafe-inline' 'unsafe-eval' blob:;
                   connect-src * 'unsafe-inline';
                   img-src * data: blob: 'unsafe-inline';
                   style-src * 'unsafe-inline';">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- Nuestros estilos y scripts -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- LOADER -->
    <div class="loader" id="loader">
        <div class="loader-logo">
            <div class="bolivia-flag"></div>
            SUBASTAS BOLIVIA
        </div>
        <div class="loader-spinner"></div>
        <div style="margin-top: 20px; color: var(--gold);">Conectando con Firebase...</div>
    </div>
    
    <!-- NOTIFICACIONES - SOLUCIÓN PROBLEMA 3 -->
    <div class="notifications-container" id="notificationsContainer"></div>
    
    <!-- HEADER -->
    <header class="header">
        <div class="logo">
            <div class="bolivia-flag"></div>
            <span>SUBASTAS BOLIVIA</span>
        </div>
        <div class="user-info">
            <span class="username" id="usernameDisplay">Invitado</span>
            <button class="login-btn" id="loginBtn">Login VIP</button>
        </div>
    </header>
    
    <!-- CONTENIDO PRINCIPAL -->
    <main class="main-content">
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-btn active" data-tab="auctions">Subastas Activas</button>
                <button class="tab-btn" data-tab="bid">Realizar Puja</button>
                <button class="tab-btn" data-tab="mybids">Mis Pujas</button>
                <button class="tab-btn" data-tab="winners">Ganadores</button>
            </div>
            
            <div class="tab-content">
                <!-- PESTAÑA: SUBASTAS ACTIVAS -->
                <div class="tab-pane active" id="auctions">
                    <h2 style="color: var(--gold); margin-bottom: 1.5rem;">Subastas en Curso</h2>
                    <div class="auctions-grid" id="auctionsGrid">
                        <!-- Las subastas se cargarán aquí dinámicamente - SOLUCIÓN PROBLEMA 4 -->
                    </div>
                </div>
                
                <!-- PESTAÑA: REALIZAR PUJA -->
                <div class="tab-pane" id="bid">
                    <h2 style="color: var(--gold); margin-bottom: 1.5rem;">Realizar una Puja</h2>
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-hand-pointer" style="font-size: 4rem; color: var(--gold); margin-bottom: 1.5rem;"></i>
                        <p style="color: #CCCCCC; max-width: 500px; margin: 0 auto 2rem;">
                            Selecciona una subasta de la pestaña "Subastas Activas" para realizar tu puja.
                        </p>
                        <button class="btn-primary" id="goToAuctionsBtn">
                            Ver Subastas Activas
                        </button>
                    </div>
                </div>
                
                <!-- PESTAÑA: MIS PUJAS -->
                <div class="tab-pane" id="mybids">
                    <h2 style="color: var(--gold); margin-bottom: 1.5rem;">Mis Pujas</h2>
                    <div id="myBidsContent">
                        <div style="text-align: center; padding: 3rem;">
                            <i class="fas fa-history" style="font-size: 4rem; color: var(--gold); margin-bottom: 1.5rem;"></i>
                            <p style="color: #CCCCCC; max-width: 500px; margin: 0 auto;">
                                Aquí verás el historial de todas tus pujas realizadas.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- PESTAÑA: GANADORES -->
                <div class="tab-pane" id="winners">
                    <h2 style="color: var(--gold); margin-bottom: 1.5rem;">Últimos Ganadores</h2>
                    <div id="winnersContent">
                        <div style="text-align: center; padding: 3rem;">
                            <i class="fas fa-trophy" style="font-size: 4rem; color: var(--gold); margin-bottom: 1.5rem;"></i>
                            <p style="color: #CCCCCC; max-width: 500px; margin: 0 auto;">
                                Consulta los ganadores de subastas anteriores.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- MODAL DE ELECCIÓN (AUTH) -->
    <div class="modal-overlay" id="authModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Acceso VIP</h3>
                <button class="close-modal" onclick="window.auctionSystem.closeModal('authModal')">&times;</button>
            </div>
            <div id="authModalContent">
                <!-- Contenido cargado dinámicamente -->
            </div>
        </div>
    </div>
    
    <!-- MODAL LOGIN -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Iniciar Sesión</h3>
                <button class="close-modal" id="closeLoginModal">&times;</button>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Número de Teléfono</label>
                    <input type="tel" class="form-input" id="loginPhoneInput" 
                           placeholder="71234567" 
                           pattern="[0-9]{7,10}" 
                           required
                           title="7-10 dígitos, sin espacios ni guiones">
                    <small style="color: #888; font-size: 0.8rem;">El mismo con el que te registraste</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contraseña</label>
                    <input type="password" class="form-input" id="loginPasswordInput" 
                           placeholder="Tu contraseña" 
                           minlength="6"
                           required>
                    <small style="color: #888; font-size: 0.8rem;">Mínimo 6 caracteres</small>
                </div>
                
                <div class="form-buttons">
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                    </button>
                    <button type="button" class="btn-secondary" id="cancelLoginBtn">Cancelar</button>
                </div>
                
                <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-light);">
                    <p style="color: #888; margin-bottom: 0.5rem;">¿No tienes cuenta?</p>
                    <button type="button" class="btn-secondary" id="openRegisterBtn" style="width: 100%;">
                        <i class="fas fa-user-plus"></i> Registrarme
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- MODAL REGISTRO -->
    <div class="modal-overlay" id="registerModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Registrarse</h3>
                <button class="close-modal" onclick="window.auctionSystem.closeModal('registerModal')">&times;</button>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label">Número de Teléfono</label>
                    <input type="tel" class="form-input" id="registerPhoneInput" 
                           placeholder="71234567" 
                           pattern="[0-9]{7,10}" 
                           required
                           title="7-10 dígitos, sin espacios ni guiones">
                    <small style="color: #888; font-size: 0.8rem;">7-10 dígitos, sin espacios ni guiones</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nombre de Usuario</label>
                    <input type="text" class="form-input" id="registerUsernameInput" 
                           placeholder="UsuarioVIP" 
                           pattern="[a-zA-Z0-9_]{3,20}" 
                           required
                           title="3-20 caracteres (letras, números, _)">
                    <small style="color: #888; font-size: 0.8rem;">3-20 caracteres (letras, números, _)</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contraseña</label>
                    <input type="password" class="form-input" id="registerPasswordInput" 
                           placeholder="Crea una contraseña segura" 
                           minlength="6"
                           required>
                    <small style="color: #888; font-size: 0.8rem;">Mínimo 6 caracteres</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirmar Contraseña</label>
                    <input type="password" class="form-input" id="registerConfirmPasswordInput" 
                           placeholder="Repite tu contraseña" 
                       minlength="6"
                       required>
                </div>
                
                <div class="form-buttons">
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-user-plus"></i> Crear Cuenta
                    </button>
                    <button type="button" class="btn-secondary" onclick="window.auctionSystem.closeModal('registerModal')">
                        Cancelar
                    </button>
                </div>
                
                <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-light);">
                    <p style="color: #888; margin-bottom: 0.5rem;">¿Ya tienes cuenta?</p>
                    <button type="button" class="btn-secondary" id="openLoginBtn" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- MODAL DETALLE DE SUBASTA -->
    <div class="modal-overlay" id="auctionModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="auctionModalTitle">Detalle de Subasta</h3>
                <button class="close-modal" id="closeAuctionModal">&times;</button>
            </div>
            <div id="auctionModalContent">
                <!-- Contenido cargado dinámicamente -->
            </div>
        </div>
    </div>
    
    <!-- MODAL REALIZAR PUJA -->
    <div class="modal-overlay" id="bidModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Realizar Puja</h3>
                <button class="close-modal" id="closeBidModal">&times;</button>
            </div>
            <div id="bidModalContent">
                <!-- Contenido cargado dinámicamente -->
            </div>
        </div>
    </div>
    
    <!-- BOTONES ADMIN Y DEBUG -->
    <button class="admin-btn" id="adminBtn" title="Panel de Administración">
        <i class="fas fa-crown"></i>
    </button>
    
    <button class="debug-btn" id="debugBtn" title="Modo Debug">
        DBG
    </button>
    
    <!-- PANEL DE ADMINISTRACIÓN -->
    <div class="admin-panel" id="adminPanel">
        <div style="margin-bottom: 2rem;">
            <h2 style="color: var(--gold); margin-bottom: 1rem;">Panel de Administración</h2>
            <div class="admin-tabs">
                <button class="admin-tab active" data-admin-tab="create">Crear Subasta</button>
                <button class="admin-tab" data-admin-tab="manage">Gestionar</button>
                <button class="admin-tab" data-admin-tab="users">Usuarios</button>
                <button class="admin-tab" data-admin-tab="bans">Baneos</button>
                <button class="admin-tab" data-admin-tab="security">Seguridad</button>
                <button class="admin-tab" data-admin-tab="export">Exportar</button>
            </div>
        </div>
        
        <!-- CONTENIDO DEL PANEL ADMIN -->
        <div id="adminContent">
            <!-- PESTAÑA CREAR SUBASTA -->
            <div class="admin-pane active" id="adminCreate">
                <h3 style="color: var(--gold); margin-bottom: 1rem;">Crear Nueva Subasta</h3>
                <form id="createAuctionForm">
                    <div class="form-group">
                        <label class="form-label">Título</label>
                        <input type="text" class="form-input" id="auctionTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-textarea" id="auctionDescription" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">URL de Imagen</label>
                        <input type="url" class="form-input" id="auctionImage" 
                               placeholder="https://ejemplo.com/imagen.jpg" 
                               required
                               title="URL válida de imagen">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Puja Inicial (Bs)</label>
                        <input type="number" class="form-input" id="auctionStartBid" 
                               min="10" step="10" value="100" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Participantes Máximos</label>
                        <input type="number" class="form-input" id="auctionMaxParticipants" 
                               min="1" max="100" value="50" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Duración (minutos)</label>
                        <input type="number" class="form-input" id="auctionDuration" 
                               min="1" max="1440" value="60" required>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="btn-primary">Crear Subasta</button>
                        <button type="button" class="btn-secondary" id="resetAdminFormBtn">Limpiar</button>
                    </div>
                </form>
            </div>
            
            <!-- PESTAÑA GESTIONAR -->
            <div class="admin-pane" id="adminManage">
                <div class="admin-section">
                    <h3 class="admin-section-title">Gestionar Subastas</h3>
                    <div id="adminAuctionsList">
                        <!-- Lista de subastas para admin -->
                    </div>
                </div>
            </div>
            
            <!-- PESTAÑA USUARIOS -->
            <div class="admin-pane" id="adminUsers">
                <div class="admin-section">
                    <h3 class="admin-section-title">Usuarios Registrados</h3>
                    <div id="adminUsersList">
                        <!-- Lista de usuarios -->
                    </div>
                </div>
            </div>
            
            <!-- PESTAÑA BANEOS -->
            <div class="admin-pane" id="adminBans">
                <div class="admin-section">
                    <h3 class="admin-section-title">Sistema de Baneos</h3>
                    <div id="adminBansContent">
                        <!-- Contenido de baneos -->
                    </div>
                </div>
            </div>
            
            <!-- PESTAÑA SEGURIDAD -->
            <div class="admin-pane" id="adminSecurity">
                <div class="admin-section">
                    <h3 class="admin-section-title">Panel de Seguridad</h3>
                    <div id="adminSecurityContent">
                        <!-- Contenido de seguridad -->
                    </div>
                </div>
            </div>
            
            <!-- PESTAÑA EXPORTAR -->
            <div class="admin-pane" id="adminExport">
                <div class="admin-section">
                    <h3 class="admin-section-title">Exportar Datos</h3>
                    <div id="adminExportContent">
                        <!-- Contenido de exportación -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cargar nuestros scripts -->
    <script src="config.js"></script>
    <script src="app.js"></script>
</body>
</html>
